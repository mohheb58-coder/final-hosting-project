<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
Â  Â <script src="https://cdn.jsdelivr.net/npm/jdate@1.0.0/dist/jdate.min.js"></script> <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª ØºÛŒØ¨Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</title>
Â  Â  <script src="https://unpkg.com/jdate/jdate.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  Â  Â  body { font-family: 'Tahoma', 'Arial', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
Â  Â  Â  Â  .container { max-width: 1200px; margin: 0 auto; }
Â  Â  Â  Â  .header { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; text-align: center; }
Â  Â  Â  Â  h1 { color: #667eea; margin-bottom: 10px; }
Â  Â  Â  Â  .tabs { display: flex; justify-content: center; margin-bottom: 20px; }
Â  Â  Â  Â  .tab-button { background: #f0f0f0; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; color: #333; transition: background 0.3s; border-radius: 8px 8px 0 0; margin: 0 2px; border-bottom: 3px solid transparent; }
Â  Â  Â  Â  .tab-button.active { background: #fff; color: #667eea; border-bottom: 3px solid #667eea; font-weight: bold; }
Â  Â  Â  Â  .tab-content { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; }
Â  Â  Â  Â  .tab-content.active { display: block; }
Â  Â  Â  Â  .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
Â  Â  Â  Â  .date-display { font-size: 18px; font-weight: bold; color: #764ba2; }
Â  Â  Â  Â  .filter-group { display: flex; gap: 10px; align-items: center; }
Â  Â  Â  Â  select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
Â  Â  Â  Â  #students-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; margin-bottom: 20px; }
Â  Â  Â  Â  .student-item { background: #f9f9f9; padding: 15px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #eee; transition: border 0.2s; cursor: pointer; }
Â  Â  Â  Â  .student-item.selected { background: #e6f7ff; border-color: #667eea; }
Â  Â  Â  Â  .student-info { display: flex; flex-direction: column; align-items: flex-start; }
Â  Â  Â  Â  .student-name { font-weight: bold; color: #333; font-size: 1.1em; }
Â  Â  Â  Â  .student-details { font-size: 0.9em; color: #666; margin-top: 5px; }
Â  Â  Â  Â  .student-index { font-weight: bold; color: #764ba2; margin-left: 10px; }
Â  Â  Â  Â  button { background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; transition: background 0.3s, transform 0.1s; }
Â  Â  Â  Â  button:hover { background: #5a6edb; }
Â  Â  Â  Â  button:active { transform: scale(0.98); }
Â  Â  Â  Â  #status-message { margin-top: 20px; padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; display: none; }
Â  Â  Â  Â  .success { background: #d4edda; color: #155724; }
Â  Â  Â  Â  .error { background: #f8d7da; color: #721c24; }
Â  Â  Â  Â  #manager-report-content { white-space: pre-wrap; font-family: Tahoma, Arial, monospace; background: #f0f0f0; padding: 15px; border-radius: 8px; min-height: 200px; border: 1px solid #ccc; margin-top: 20px; }
Â  Â  Â  Â  #records-search-tab { display: flex; flex-direction: column; gap: 20px; }
Â  Â  Â  Â  #records-search-input { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; width: 100%; max-width: 400px; margin-left: 10px; }
Â  Â  Â  Â  .search-controls { display: flex; align-items: center; gap: 10px; }
Â  Â  Â  Â  #records-search-result { margin-top: 15px; padding: 20px; border-radius: 8px; background: #e6f7ff; border: 1px solid #667eea; min-height: 100px; display: flex; align-items: center; justify-content: center; font-size: 1.1em; color: #333; text-align: center; flex-direction: column; }
Â  Â  Â  Â  .result-count { font-size: 2.5em; color: #764ba2; font-weight: bold; display: block; margin-top: 10px; }
Â  Â  </style>
</head>
<body>

Â  Â  <div class="container">
Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <h1>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ ØºÛŒØ¨Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h1>
Â  Â  Â  Â  Â  Â  <div class="date-display" id="date-display"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="tabs">
Â  Â  Â  Â  Â  Â  <button class="tab-button active" onclick="openTab('absence-tab')">Ø«Ø¨Øª ØºÛŒØ¨Øª</button>
Â  Â  Â  Â  Â  Â  <button class="tab-button" onclick="openTab('manager-report-tab')">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø¯ÛŒØ±</button>
Â  Â  Â  Â  Â  Â  <button class="tab-button" onclick="openTab('records-search-tab')">Ú¯Ø²Ø§Ø±Ø´ Ø³ÙˆØ§Ø¨Ù‚</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="absence-tab" class="tab-content active">
Â  Â  Â  Â  Â  Â  <div class="controls">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="grade-filter">Ù¾Ø§ÛŒÙ‡:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="grade-filter"><option value="">Ù‡Ù…Ù‡</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="class-filter">Ú©Ù„Ø§Ø³:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="class-filter"><option value="">Ù‡Ù…Ù‡</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="students-list">Ø¯Ø±Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†...</div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button id="submit-btn" disabled>âœ… Ø«Ø¨Øª ØºÛŒØ¨Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</button>
Â  Â  Â  Â  Â  Â  <div id="status-message"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="manager-report-tab" class="tab-content">
Â  Â  Â  Â  Â  Â  <h2>Ú¯Ø²Ø§Ø±Ø´ ØºØ§ÛŒØ¨ÛŒÙ† Ø§Ù…Ø±ÙˆØ² (Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„)</h2>
Â  Â  Â  Â  Â  Â  <button id="copy-manager-report-btn" style="margin-top: 15px; background: #28a745;">ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø§Ù…Ø±ÙˆØ²</button>
Â  Â  Â  Â  Â  Â  <pre id="manager-report-content">Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨ÛŒÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ù…Ø§ Ø¯Ø± ØªØ¨ "Ø«Ø¨Øª ØºÛŒØ¨Øª" ØªÙˆÙ„ÛŒØ¯ Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</pre>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="records-search-tab" class="tab-content">
Â  Â  Â  Â  Â  Â  <h2>Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³ÙˆØ§Ø¨Ù‚ ØºÛŒØ¨Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h2>
Â  Â  Â  Â  Â  Â  <div class="search-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="records-search-input" placeholder="Ù†Ø§Ù… ÛŒØ§ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="search-records-btn" style="background: #ffc107; color: #333;">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="records-search-result">Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ) Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // âš ï¸ Ù…Ù‡Ù…: Ø§ÛŒÙ† Ø¢Ø¯Ø±Ø³ Apps Script Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡ Ø®ÙˆØ¯ØªØ§Ù† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆØ¯
Â  Â  Â  Â  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx5-XlYeSRCoYnImDxbqqrcTZMFLYvx0g6E1ZkER_wgY1yhvgkQYUyZfbnv2pe6fdyL/exec';Â 

Â  Â  Â  Â  let allStudents = [];
Â  Â  Â  Â  let selectedStudents = new Set();
Â  Â  Â  Â Â 
Â  Â  Â  Â  function openTab(tabName) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
Â  Â  Â  Â  Â  Â  document.getElementById(tabName).classList.add('active');
Â  Â  Â  Â  Â  Â  document.querySelector(`button[onclick="openTab('${tabName}')"]`).classList.add('active');
Â  Â  Â  Â  Â  Â  if (tabName === 'manager-report-tab') { generateManagerReport(); }
Â  Â  Â  Â  Â  Â  if (tabName === 'records-search-tab') { document.getElementById('records-search-result').innerHTML = 'Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ (ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ) Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.'; }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function loadData() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸ”´ Ø§ØµÙ„Ø§Ø­ Ù…Ø³ÛŒØ±Ø¯Ù‡ÛŒ Ø¨Ø±Ø§ÛŒ GitHub Pages (Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† /)
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch('/index.csv');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const csvText = await response.text();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const rows = csvText.split('\n').filter(row => row.trim() !== '').slice(1);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  allStudents = rows.map((row) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // split Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ø§Ù…Ø§ (,) ÛŒØ§ Ù†Ù‚Ø·Ù‡ ÙˆÛŒØ±Ú¯ÙˆÙ„ (;) Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø­ÙˆÙ‡ Ø°Ø®ÛŒØ±Ù‡ CSV Ø¯Ø± Ø§Ú©Ø³Ù„
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø¯Ø± Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ ÙØ±Ø¶ Ù…ÛŒ Ú©Ù†ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ø§Ù…Ø§ Ø§Ø³Øª. Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¯Ø§Ø¯ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ; ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒÙ….
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const columns = row.split(',').map(col => col.trim().replace(/"/g, ''));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø®ØªØ§Ø± Ø´Ù…Ø§: 0:ID, 1:Ù†Ø§Ù…, 2:Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ, 3:Ù¾Ø§ÛŒÙ‡, 4:Ú©Ù„Ø§Ø³, 5:Ù…Ø¹Ù„Ù…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const idIndex = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nameIndex = 1;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastNameIndex = 2;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const gradeIndex = 3;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const classNumberIndex = 4;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const teacherIndex = 5;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: columns[idIndex] || Math.random(),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  firstName: columns[nameIndex] || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastName: columns[lastNameIndex] || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grade: columns[gradeIndex] || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  classNumber: columns[classNumberIndex] || '',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  teacher: columns[teacherIndex] || ''
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  }).filter(s => s.firstName && s.lastName);

Â  Â  Â  Â  Â  Â  Â  Â  populateFilters();
Â  Â  Â  Â  Â  Â  Â  Â  renderStudentsList();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error loading student data:", error);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('students-list').innerHTML = '<div class="error" style="grid-column: 1 / -1; text-align: center;">âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ÙØ§ÛŒÙ„ **/index.csv** Ø¯Ø± Ø±ÛŒØ´Ù‡ Ù…Ø®Ø²Ù† Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯ Ùˆ Ø¨Ø§ **UTF-8** Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function populateFilters() {
Â  Â  Â  Â  Â  Â  const gradeFilter = document.getElementById('grade-filter');
Â  Â  Â  Â  Â  Â  const classFilter = document.getElementById('class-filter');
Â  Â  Â  Â  Â  Â  const grades = new Set(allStudents.map(s => s.grade).filter(g => g));
Â  Â  Â  Â  Â  Â  const classNumbers = new Set(allStudents.map(s => s.classNumber).filter(c => c));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  gradeFilter.innerHTML = '<option value="">Ù‡Ù…Ù‡</option>';
Â  Â  Â  Â  Â  Â  grades.forEach(grade => { const option = document.createElement('option'); option.value = grade; option.textContent = grade; gradeFilter.appendChild(option); });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  classFilter.innerHTML = '<option value="">Ù‡Ù…Ù‡</option>';
Â  Â  Â  Â  Â  Â  classNumbers.forEach(classNum => { const option = document.createElement('option'); option.value = classNum; option.textContent = classNum; classFilter.appendChild(option); });

Â  Â  Â  Â  Â  Â  gradeFilter.addEventListener('change', renderStudentsList);
Â  Â  Â  Â  Â  Â  classFilter.addEventListener('change', renderStudentsList);
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderStudentsList() {
Â  Â  Â  Â  Â  Â  const listContainer = document.getElementById('students-list');
Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const selectedGrade = document.getElementById('grade-filter').value;
Â  Â  Â  Â  Â  Â  const selectedClass = document.getElementById('class-filter').value;

Â  Â  Â  Â  Â  Â  let filteredStudents = allStudents.filter(s => {
Â  Â  Â  Â  Â  Â  Â  Â  const gradeMatch = !selectedGrade || s.grade === selectedGrade;
Â  Â  Â  Â  Â  Â  Â  Â  const classMatch = !selectedClass || s.classNumber === selectedClass;
Â  Â  Â  Â  Â  Â  Â  Â  return gradeMatch && classMatch;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  filteredStudents.sort((a, b) => a.lastName.localeCompare(b.lastName, 'fa'));

Â  Â  Â  Â  Â  Â  if (filteredStudents.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  listContainer.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #777;">Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('submit-btn').disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  filteredStudents.forEach((student, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'student-item';
Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.studentId = student.id;

Â  Â  Â  Â  Â  Â  Â  Â  if (selectedStudents.has(student.id)) { item.classList.add('selected'); }

Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="student-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="student-name">${student.firstName} ${student.lastName}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="student-details">Ù¾Ø§ÛŒÙ‡: ${student.grade}, Ú©Ù„Ø§Ø³: ${student.classNumber}, Ù…Ø¹Ù„Ù…: ${student.teacher}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="student-index">${index + 1}</span>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  item.addEventListener('click', () => toggleSelection(student.id, item));
Â  Â  Â  Â  Â  Â  Â  Â  listContainer.appendChild(item);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  updateSubmitButtonStatus();
Â  Â  Â  Â  }

Â  Â  Â  Â  function toggleSelection(studentId, element) {
Â  Â  Â  Â  Â  Â  if (selectedStudents.has(studentId)) {
Â  Â  Â  Â  Â  Â  Â  Â  selectedStudents.delete(studentId);
Â  Â  Â  Â  Â  Â  Â  Â  element.classList.remove('selected');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  selectedStudents.add(studentId);
Â  Â  Â  Â  Â  Â  Â  Â  element.classList.add('selected');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateSubmitButtonStatus();
Â  Â  Â  Â  Â  Â  if (document.getElementById('manager-report-tab').classList.contains('active')) { generateManagerReport(); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function updateSubmitButtonStatus() {
Â  Â  Â  Â  Â  Â  const submitBtn = document.getElementById('submit-btn');
Â  Â  Â  Â  Â  Â  submitBtn.disabled = selectedStudents.size === 0;
Â  Â  Â  Â  Â  Â  submitBtn.textContent = selectedStudents.size === 0Â 
Â  Â  Â  Â  Â  Â  Â  Â  ? 'âœ… Ø«Ø¨Øª ØºÛŒØ¨Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡'Â 
Â  Â  Â  Â  Â  Â  Â  Â  : `âœ… Ø«Ø¨Øª ØºÛŒØ¨Øª ${selectedStudents.size} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡`;
Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById('submit-btn').addEventListener('click', async function() {
Â  Â  Â  Â  Â  Â  const statusMessage = document.getElementById('status-message');
Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'none';
Â  Â  Â  Â  Â  Â  this.disabled = true;
Â  Â  Â  Â  Â  Â  if (selectedStudents.size === 0) return;
Â  Â  Â  Â  Â  Â  if (APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_PUBLISHED_URL') { showMessage('âŒ Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ø¢Ø¯Ø±Ø³ Apps Script Ø±Ø§ Ø¯Ø± Ú©Ø¯ HTML Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯!', 'error'); this.disabled = false; return; }

Â  Â  Â  Â  Â  Â  const selectedData = [];
Â  Â  Â  Â  Â  Â  const currentDate = new JDate().format('yyyy/mm/dd');

Â  Â  Â  Â  Â  Â  selectedStudents.forEach(id => {
Â  Â  Â  Â  Â  Â  Â  Â  const student = allStudents.find(s => s.id === id);
Â  Â  Â  Â  Â  Â  Â  Â  if (student) { selectedData.push({ name: student.firstName, lastName: student.lastName, grade: student.grade, classNumber: student.classNumber, teacher: student.teacher, date: currentDate }); }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙˆØ¬Ù‡: Ø¯Ø± Ø­Ø§Ù„Øª POST Ø¨Ø§ Apps Script Ø§Ø² no-cors Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒ Ú©Ù†ÛŒÙ….
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(APPS_SCRIPT_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify({ action: 'registerAbsence', data: selectedData })
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  showMessage('Ø«Ø¨Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯! ğŸ˜Š', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  // Ù¾Ø³ Ø§Ø² Ø«Ø¨Øª Ù…ÙˆÙÙ‚ØŒ ØºØ§ÛŒØ¨ÛŒÙ† Ø±Ø§ Ø§Ø² Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ù…ÛŒ Ú©Ù†ÛŒÙ…
Â  Â  Â  Â  Â  Â  Â  Â  selectedStudents.clear();
Â  Â  Â  Â  Â  Â  Â  Â  renderStudentsList();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error submitting data:', error);
Â  Â  Â  Â  Â  Â  Â  Â  showMessage('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø¨Ù‡ Google Sheets! (Ø§ØªØµØ§Ù„ Apps Script Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯)', 'error');
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  this.disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  function showMessage(message, type) {
Â  Â  Â  Â  Â  Â  const statusMessage = document.getElementById('status-message');
Â  Â  Â  Â  Â  Â  statusMessage.textContent = message;
Â  Â  Â  Â  Â  Â  statusMessage.className = 'status-message ' + type;
Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'block';
Â  Â  Â  Â  Â  Â  setTimeout(() => { statusMessage.style.display = 'none'; }, 5000);
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateDateDisplay() {
Â  Â  Â  Â  Â  Â  // ğŸ”´ Ø§ØµÙ„Ø§Ø­ Ø®Ø·Ø§ÛŒ date is not defined: ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ± date
Â  Â  Â  Â  Â  Â  const date = new JDate(); 
Â  Â  Â  Â  Â  Â  const formattedDate = date.format('yyyy/mm/dd (W)');
Â  Â  Â  Â  Â  Â  document.getElementById('date-display').textContent = `ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ²: ${formattedDate}`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function generateManagerReport() {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('manager-report-content');
Â  Â  Â  Â  Â  Â  if (selectedStudents.size === 0) { container.textContent = 'âŒ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¨Ø±Ø§ÛŒ ØºÛŒØ¨Øª Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.'; return; }

Â  Â  Â  Â  Â  Â  const absentStudents = Array.from(selectedStudents).map(id => allStudents.find(s => s.id === id)).filter(s => s);
Â  Â  Â  Â  Â  Â  // ğŸ”´ Ø§ØµÙ„Ø§Ø­ Ø®Ø·Ø§ÛŒ date is not defined: ØªØ¹Ø±ÛŒÙ Ù…ØªØºÛŒØ± ØªØ§Ø±ÛŒØ® Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´
Â  Â  Â  Â  Â  Â  const currentDate = new JDate().format('yyyy/mm/dd'); 
Â  Â  Â  Â  Â  Â  let report = `âœ… Ú¯Ø²Ø§Ø±Ø´ ØºØ§ÛŒØ¨ÛŒÙ† Ù…ÙˆØ±Ø® ${currentDate}:\n\n`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Ú¯Ø±ÙˆÙ‡ Ø¨Ù†Ø¯ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù¾Ø§ÛŒÙ‡ Ùˆ Ú©Ù„Ø§Ø³
Â  Â  Â  Â  Â  Â  const grouped = absentStudents.reduce((acc, student) => {
Â  Â  Â  Â  Â  Â  Â  Â  const key = `Ù¾Ø§ÛŒÙ‡ ${student.grade} / Ú©Ù„Ø§Ø³ ${student.classNumber} (Ù…Ø¹Ù„Ù…: ${student.teacher})`;
Â  Â  Â  Â  Â  Â  Â  Â  if (!acc[key]) { acc[key] = []; }
Â  Â  Â  Â  Â  Â  Â  Â  acc[key].push(student);
Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  }, {});

Â  Â  Â  Â  Â  Â  Object.keys(grouped).sort().forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  report += `ğŸ“‹ ${key}:\n`;
Â  Â  Â  Â  Â  Â  Â  Â  grouped[key].sort((a, b) => a.lastName.localeCompare(b.lastName, 'fa'));
Â  Â  Â  Â  Â  Â  Â  Â  grouped[key].forEach((s, i) => { report += `Â  Â ${i + 1}. ${s.firstName} ${s.lastName}\n`; });
Â  Â  Â  Â  Â  Â  Â  Â  report += `\n`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  report += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
Â  Â  Â  Â  Â  Â  report += `ğŸ™ Ù„Ø·ÙØ§Ù‹ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¬Ù‡Øª Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø§Ù‚Ø¯Ø§Ù… Ù†Ù…Ø§ÛŒÛŒØ¯.`;
Â  Â  Â  Â  Â  Â  container.textContent = report;
Â  Â  Â  Â  }

Â  Â  Â  Â  document.getElementById('copy-manager-report-btn').addEventListener('click', function() {
Â  Â  Â  Â  Â  Â  const report = document.getElementById('manager-report-content').textContent;
Â  Â  Â  Â  Â  Â  if (report && !report.includes('âŒ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ')) {
Â  Â  Â  Â  Â  Â  Â  Â  navigator.clipboard.writeText(report).then(() => { alert('âœ… Ú¯Ø²Ø§Ø±Ø´ ØºØ§ÛŒØ¨ÛŒÙ† Ø§Ù…Ø±ÙˆØ² Ú©Ù¾ÛŒ Ø´Ø¯!'); }).catch(() => { alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.'); });
Â  Â  Â  Â  Â  Â  } else { alert('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† ØºØ§ÛŒØ¨ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.'); }
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('search-records-btn').addEventListener('click', async function() {
Â  Â  Â  Â  Â  Â  const searchName = document.getElementById('records-search-input').value.trim();
Â  Â  Â  Â  Â  Â  const resultDiv = document.getElementById('records-search-result');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (searchName.length < 2) { resultDiv.innerHTML = 'Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ Ø¯Ùˆ Ø­Ø±Ù Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'; return; }
Â  Â  Â  Â  Â  Â  if (APPS_SCRIPT_URL === 'YOUR_APPS_SCRIPT_PUBLISHED_URL') { resultDiv.innerHTML = 'âŒ Ø®Ø·Ø§: Ø¢Ø¯Ø±Ø³ Apps Script Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.'; return; }

Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = 'Ø¯Ø±Ø­Ø§Ù„ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³ÙˆØ§Ø¨Ù‚... âŒ›';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const url = APPS_SCRIPT_URL + '?action=getAbsenceCount&name=' + encodeURIComponent(searchName);
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(url);
Â  Â  Â  Â  Â  Â  Â  Â  const text = await response.text();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let data;
Â  Â  Â  Â  Â  Â  Â  Â  try { data = JSON.parse(text); } catch (e) { resultDiv.innerHTML = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø® Ø§Ø² Ø³Ø±ÙˆØ±. (Ø¢Ø¯Ø±Ø³ Apps Script Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯)`; return; }

Â  Â  Â  Â  Â  Â  Â  Â  if (data.error) { resultDiv.innerHTML = `âŒ Ø®Ø·Ø§: ${data.error}`; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else if (data.count === undefined) { resultDiv.innerHTML = `âŒ Ø®Ø·Ø§: Ù¾Ø§Ø³Ø®ÛŒ Ø§Ø² Ø³Ø±ÙˆØ± Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯. (Apps Script Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯)`; }Â 
Â  Â  Â  Â  Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø§Ø² Ù„ÛŒØ³Øª Ù…Ø­Ù„ÛŒ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const studentInfo = allStudents.find(s => s.firstName.includes(searchName) || s.lastName.includes(searchName));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const studentDisplay = studentInfoÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `${studentInfo.firstName} ${studentInfo.lastName} (Ù¾Ø§ÛŒÙ‡: ${studentInfo.grade}ØŒ Ú©Ù„Ø§Ø³: ${studentInfo.classNumber}ØŒ Ù…Ø¹Ù„Ù…: ${studentInfo.teacher})`Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : searchName;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ **${studentDisplay}**:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="result-count">${data.count}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 0.9em; color: #555; margin-top: 10px;">(Ø§ÛŒÙ† Ø¹Ø¯Ø¯ Ø§Ø² Ø³ÙˆØ§Ø¨Ù‚ Google Sheets Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.)</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching records:', error);
Â  Â  Â  Â  Â  Â  Â  Â  resultDiv.innerHTML = 'âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Apps Script Ø´Ù…Ø§ Ø¯Ø±Ø³Øª ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ùˆ Ø¯Ø± Ø­Ø§Ù„Øª "Anyone" Ù…Ù†ØªØ´Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª.';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  updateDateDisplay();
Â  Â  Â  Â  loadData();
Â  Â  Â  Â  openTab('absence-tab');
Â  Â  </script>
</body>
</html>



