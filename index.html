<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.35);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .content {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4338ca;
            font-size: 1em;
        }
        
        select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e7ff;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s;
            background: white;
            color: #1e293b;
        }
        
        select:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }
        
        .students-list {
            display: none;
            margin-top: 25px;
        }
        
        .students-list h3 {
            margin-bottom: 15px;
            color: #4338ca;
            font-size: 1.1em;
        }
        
        .student-item {
            display: flex;
            align-items: center;
            padding: 14px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            margin-bottom: 10px;
            border-radius: 12px;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
        }
        
        .student-item:hover {
            background: linear-gradient(135deg, #e0e7ff 0%, #ddd6fe 100%);
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
        }
        
        .student-item.absent {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .student-number {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            margin-left: 12px;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }
        
        .student-item.absent .student-number {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .student-item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-left: 12px;
            cursor: pointer;
            accent-color: #ef4444;
        }
        
        .student-name {
            font-size: 1em;
            color: #1e293b;
            flex: 1;
        }
        
        .student-emoji {
            font-size: 1.5em;
            transition: all 0.3s;
        }
        
        .student-item.absent .student-emoji {
            filter: grayscale(100%);
            opacity: 0.5;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }
        
        button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-save {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-save:hover:not(:disabled) {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-manager {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-manager:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
            transform: translateY(-2px);
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-reset:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
            transform: translateY(-2px);
        }
        
        .manager-view {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 15px;
            border: 2px solid #f59e0b;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }
        
        .manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .manager-view h3 {
            color: #92400e;
            margin: 0;
            font-size: 1.1em;
        }
        
        .btn-copy {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 0.9em;
            border: none;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(139, 92, 246, 0.3);
            transition: all 0.3s;
        }
        
        .btn-copy:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
        }
        
        .date-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.05em;
            box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
        }
        
        .absent-list {
            background: white;
            padding: 15px;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .absent-item {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
        }
        
        .absent-item:last-child {
            border-bottom: none;
        }
        
        .success-message {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            border: 2px solid #10b981;
            animation: slideIn 0.3s ease-out;
            font-weight: 500;
        }
        
        .error-message {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            border: 2px solid #ef4444;
            animation: slideIn 0.3s ease-out;
            font-weight: 500;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .info-box {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-right: 4px solid #3b82f6;
            color: #1e40af;
            font-size: 0.95em;
        }
        
        .student-count {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            color: #4338ca;
            border: 2px solid #6366f1;
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        .loading-spinner {
            text-align: center;
            padding: 20px;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="copy-notification" id="copyNotification">âœ… Ú©Ù¾ÛŒ Ø´Ø¯!</div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ« Ø³ÛŒØ³ØªÙ… Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h1>
            <p>Ù…Ø¯Ø±Ø³Ù‡ Ù¾Ø³Ø±Ø§Ù†Ù‡ Ø´Ù‡ÛŒØ¯ Ù†ÛŒØ§Ø³Ø±ÛŒ Û±</p>
        </div>
        
        <div class="content">
            <div class="info-box">
                ğŸ“Œ Ø§Ø¨ØªØ¯Ø§ Ù¾Ø§ÛŒÙ‡ Ùˆ Ú©Ù„Ø§Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ØŒ Ø³Ù¾Ø³ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† ØºØ§ÛŒØ¨ Ø±Ø§ ØªÛŒÚ© Ø¨Ø²Ù†ÛŒØ¯
            </div>
            
            <div class="form-group">
                <label for="grade">ğŸ“š Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ø§ÛŒÙ‡:</label>
                <select id="grade" onchange="loadClasses()">
                    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                    <option value="Ø§ÙˆÙ„">Ø§ÙˆÙ„</option>
                    <option value="Ø¯ÙˆÙ…">Ø¯ÙˆÙ…</option>
                    <option value="Ø³ÙˆÙ…">Ø³ÙˆÙ…</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="class">ğŸ“ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù„Ø§Ø³:</label>
                <select id="class" disabled onchange="loadStudents()">
                    <option value="">-- Ø§Ø¨ØªØ¯Ø§ Ù¾Ø§ÛŒÙ‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                </select>
            </div>
            
            <div class="students-list" id="studentsList">
                <div class="student-count" id="studentCount"></div>
                <h3>ğŸ‘¥ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† - ØºØ§ÛŒØ¨â€ŒÙ‡Ø§ Ø±Ø§ ØªÛŒÚ© Ø¨Ø²Ù†ÛŒØ¯:</h3>
                <div id="studentsContainer"></div>
            </div>
            
            <div class="button-group" id="buttonGroup" style="display: none;">
                <button class="btn-save" onclick="saveAttendance()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§</button>
                <button class="btn-manager" onclick="loadManagerView()">ğŸ‘¨â€ğŸ’¼ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±</button>
                <button class="btn-reset" onclick="resetForm()">ğŸ”„ Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</button>
            </div>
            
            <div class="success-message" id="successMessage"></div>
            <div class="error-message" id="errorMessage"></div>
            
            <div class="manager-view" id="managerView">
                <div class="manager-header">
                    <h3>ğŸ“‹ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ± - Ù‡Ù…Ù‡ ØºØ§ÛŒØ¨â€ŒÙ‡Ø§</h3>
                    <button class="btn-copy" onclick="copyAbsentList()">ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒØ³Øª</button>
                </div>
                <div class="absent-list" id="absentList">
                    <div class="loading-spinner">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
                </div>
            </div>
        </div>
    </div>
<script>
       // ğŸ¯ Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ (Global) Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ ØªØ¹Ø±ÛŒÙ Ø´ÙˆØ¯
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxjg_DfojiDpY2DXx6SxcZjypbo3zvowZMi5Zsj8dhb1rXw_LsKtn8L--59rgFd5UBK/exec'; 

        
        const students = [
            {name: "Ø¹Ù„ÛŒ Ø§ØµØºØ±", family: "Ø¨ÛŒÚ©Ø¯Ù„ÛŒ", grade: "Ø³ÙˆÙ…", class: "3", teacher: "Ø®Ø§Ù†Ù… Ù†ÙˆÛŒØ¯ÛŒ"},
            {name: "Ø¨Ø±Ø¯ÛŒØ§", family: "ØµØ¨Ø§Ø®", grade: "Ø³ÙˆÙ…", class: "1", teacher: "Ø®Ø§Ù†Ù… Ù¾ÛŒØ±Ù…ÛŒØ´Ø§Ù†ÛŒ"},
            {name: "Ø¢ÛŒØ§Ù†", family: "Ù†Ø¸Ø±ÛŒ Ù‚Ù„Ø¹Ù‡ Ø²Ù†Ø¬ÛŒØ±ÛŒ", grade: "Ø³ÙˆÙ…", class: "2", teacher: "Ø¢Ù‚Ø§ÛŒ Ø¨Ø§Ø²ÙˆÙ†Ø¯"},
            {name: "Ú©ÙˆØ±ÙˆØ´", family: "Ù†Ø§Ø¯Ø±ÛŒ", grade: "Ø³ÙˆÙ…", class: "5", teacher: "Ø®Ø§Ù†Ù… Ù…ÙˆØ³ÙˆÛŒ"},
            {name: "Ú©ÙˆØ±ÙˆØ´", family: "Ø­ÛŒØ¯Ø±ÛŒ", grade: "Ø³ÙˆÙ…", class: "4", teacher: "Ø®Ø§Ù†Ù… ÙÛŒØ¶ÛŒ"},
            {name: "Ø§Ù…ÛŒØ±Ø¹Ù„ÛŒ", family: "Ø°Ø¨ÛŒØ­ÛŒ", grade: "Ø³ÙˆÙ…", class: "2", teacher: "Ø¢Ù‚Ø§ÛŒ Ø¨Ø§Ø²ÙˆÙ†Ø¯"},
            {name: "Ù‡ÙˆÙ…Ù†", family: "Ø³Ù„Ø·Ø§Ù† Ø¢Ø¨Ø§Ø¯ÛŒ", grade: "Ø³ÙˆÙ…", class: "2", teacher: "Ø¢Ù‚Ø§ÛŒ Ø¨Ø§Ø²ÙˆÙ†Ø¯"},
            {name: "Ù…Ø­Ù…Ø¯Ø±Ø¶Ø§", family: "Ù…Ø­Ù…Ø¯Ø²Ø§Ø¯Ù‡ Ø§Ø´Ú©ÛŒØªÛŒ", grade: "Ø³ÙˆÙ…", class: "3", teacher: "Ø®Ø§Ù†Ù… Ù†ÙˆÛŒØ¯ÛŒ"},
            {name: "Ø§Ù…ÛŒØ±Ø­Ø³ÛŒÙ†", family: "Ø§Ù…ÛŒØ±ÛŒ", grade: "Ø³ÙˆÙ…", class: "6", teacher: "Ø®Ø§Ù†Ù… ØªØ§Ø¬ÛŒÚ©"},
            {name: "Ø¢Ø±ÛŒÙ†", family: "Ø§ØµÙ„Ø§Ù†ÛŒ", grade: "Ø³ÙˆÙ…", class: "3", teacher: "Ø®Ø§Ù†Ù… Ù†ÙˆÛŒØ¯ÛŒ"}
        ];

        let allAbsentList = [];
        let currentStudents = [];
        
        function getPersianDayName(date) {
            const days = ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡'];
            return days[date.getDay()];
        }

        function loadClasses() {
            const gradeSelect = document.getElementById('grade');
            const classSelect = document.getElementById('class');
            const selectedGrade = gradeSelect.value;
            
            classSelect.innerHTML = '<option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>';
            document.getElementById('studentsList').style.display = 'none';
            document.getElementById('buttonGroup').style.display = 'none';
            
            if (selectedGrade) {
                classSelect.disabled = false;
                const classes = [...new Set(students.filter(s => s.grade === selectedGrade).map(s => s.class))].sort((a, b) => Number(a) - Number(b));
                
                classes.forEach(cls => {
                    const option = document.createElement('option');
                    option.value = cls;
                    option.textContent = `Ú©Ù„Ø§Ø³ ${cls}`;
                    classSelect.appendChild(option);
                });
            } else {
                classSelect.disabled = true;
            }
        }

        function loadStudents() {
            const grade = document.getElementById('grade').value;
            const cls = document.getElementById('class').value;
            
            if (!grade || !cls) return;
            
            currentStudents = students
                .filter(s => s.grade === grade && s.class === cls)
                .sort((a, b) => a.family.localeCompare(b.family, 'fa'));
            
            const container = document.getElementById('studentsContainer');
            const countDiv = document.getElementById('studentCount');
            container.innerHTML = '';
            
            if (currentStudents.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
                return;
            }
            
            countDiv.textContent = `ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†: ${currentStudents.length} Ù†ÙØ±`;
            
            currentStudents.forEach((student, index) => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.id = `item_${index}`;
                div.innerHTML = `
                    <div class="student-number">${index + 1}</div>
                    <input type="checkbox" id="student_${index}" onchange="updateAbsentStyle(${index})">
                    <label class="student-name" for="student_${index}">${student.name} ${student.family}</label>
                    <span class="student-emoji">ğŸ™‹â€â™‚ï¸</span>
                `;
                container.appendChild(div);
            });
            
            document.getElementById('studentsList').style.display = 'block';
            document.getElementById('buttonGroup').style.display = 'flex';
        }

        function updateAbsentStyle(index) {
            const checkbox = document.getElementById(`student_${index}`);
            const parent = document.getElementById(`item_${index}`);
            const emoji = parent.querySelector('.student-emoji');
            
            if (checkbox.checked) {
                parent.classList.add('absent');
                emoji.textContent = 'ğŸ™â€â™‚ï¸';
            } else {
                parent.classList.remove('absent');
                emoji.textContent = 'ğŸ™‹â€â™‚ï¸';
            }
        }

        function saveAttendance() {
            const grade = document.getElementById('grade').value;
            const cls = document.getElementById('class').value;
            
            if (!grade || !cls) {
                showError('Ù„Ø·ÙØ§Ù‹ Ù¾Ø§ÛŒÙ‡ Ùˆ Ú©Ù„Ø§Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const absentStudents = [];
            const now = new Date();
            const persianDate = now.toLocaleDateString('fa-IR');
            const persianDay = getPersianDayName(now);
            
            currentStudents.forEach((student, index) => {
                const checkbox = document.getElementById(`student_${index}`);
                if (checkbox && checkbox.checked) {
                    absentStudents.push({
                        name: student.name,
                        family: student.family,
                        grade: student.grade,
                        class: student.class,
                        teacher: student.teacher,
                        date: persianDate,
                        day: persianDay,
                        time: now.toLocaleTimeString('fa-IR')
                    });
                }
            });
            
            if (absentStudents.length === 0) {
                showError('Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ØºØ§ÛŒØ¨ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
                return;
            }
            
            sendToGoogleSheet(absentStudents);
        }

          function sendToGoogleSheet(absentStudents) {
        const btn = document.querySelector('.btn-save');
        btn.disabled = true;
        btn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';
        
        // âœ… Ø§Ú©Ù†ÙˆÙ† scriptURL Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒ Ø´ÙˆØ¯
        fetch(scriptURL, { 
            method: 'POST',
            body: JSON.stringify({
                action: 'saveAbsence',
                data: absentStudents
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Response:', data);
            
            if (data.status === 'success') {
                showSuccess(`âœ… ${absentStudents.length} ØºÛŒØ¨Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²
                currentStudents.forEach((_, index) => {
                    const checkbox = document.getElementById(`student_${index}`);
                    if (checkbox) checkbox.checked = false;
                    const item = document.getElementById(`item_${index}`);
                    if (item) {
                        item.classList.remove('absent');
                        const emoji = item.querySelector('.student-emoji');
                        if (emoji) emoji.textContent = 'ğŸ™‹â€â™‚ï¸'; // Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø§Ù…ÙˆØ¬ÛŒ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡
                    }
                });
            } else {
                showError(`Ø®Ø·Ø§ Ø¯Ø± Ø³Ø±ÙˆØ±: ${data.message}`);
            }
        })
        .catch(error => {
            console.error('Ø®Ø·Ø§:', error);
            showError('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯');
        })
        .finally(() => {
            btn.disabled = false;
            btn.textContent = 'ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØºÛŒØ¨Øªâ€ŒÙ‡Ø§';
        });
    }

      function loadManagerView() {
    const managerView = document.getElementById('managerView');
    const absentList = document.getElementById('absentList');
    
    // Ø§Ú¯Ø± Ø¨Ø§Ø² Ø¨ÙˆØ¯ØŒ Ø¨Ø¨Ù†Ø¯Ø´
    if (managerView.style.display === 'block') {
        managerView.style.display = 'none';
        return;
    }
    
    // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù„ÙˆØ¯ÛŒÙ†Ú¯
    managerView.style.display = 'block';
    absentList.innerHTML = '<div class="loading-spinner">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø² Google Sheet...</div>';
    
    // âœ… Ø§ØµÙ„Ø§Ø­ Ø´Ø¯: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² scriptURL Ø¨Ù‡ Ø¬Ø§ÛŒ API_URL
    fetch(`${scriptURL}?action=getAbsences`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // allAbsentList Ù…ØªØºÛŒØ± Ø¬Ø¯ÛŒØ¯ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø³Ø±Ø§Ø³Ø± ÙØ§ÛŒÙ„ ØªØ¹Ø±ÛŒÙ Ø´ÙˆØ¯
                allAbsentList = data.data; 
                displayAbsentList(); // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù„ÛŒØ³Øª Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ (Ú©Ø¯ Ø¢Ù† Ø¯Ø± Ø¨Ø®Ø´ Ø¨Ø¹Ø¯ÛŒ Ø§Ø³Øª)
            } else {
                absentList.innerHTML = `<p style="text-align: center; color: #dc2626;">Ø®Ø·Ø§: ${data.message}</p>`;
            }
        })
        .catch(error => {
            console.error('Ø®Ø·Ø§:', error);
            absentList.innerHTML = '<p style="text-align: center; color: #dc2626;">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª</p>';
        });
}

        function displayAbsentList() {
            const absentList = document.getElementById('absentList');
            
            if (allAbsentList.length === 0) {
                absentList.innerHTML = '<p style="text-align: center; color: #666;">Ù‡Ù†ÙˆØ² ØºÛŒØ¨ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>';
                return;
            }
            
            absentList.innerHTML = '';
            
            const groupedByDate = {};
            allAbsentList.forEach(student => {
                const key = `${student.day} - ${student.date}`;
                if (!groupedByDate[key]) {
                    groupedByDate[key] = [];
                }
                groupedByDate[key].push(student);
            });
            
            Object.keys(groupedByDate).forEach(dateKey => {
                const dateHeader = document.createElement('div');
                dateHeader.className = 'date-header';
                dateHeader.textContent = `ğŸ“… ${dateKey} (${groupedByDate[dateKey].length} Ù†ÙØ±)`;
                absentList.appendChild(dateHeader);
                
                groupedByDate[dateKey].forEach((student, idx) => {
                    const div = document.createElement('div');
                    div.className = 'absent-item';
                    div.innerHTML = `
                        <strong>${idx + 1}. ${student.name} ${student.family}</strong><br>
                        Ù¾Ø§ÛŒÙ‡ ${student.grade} - Ú©Ù„Ø§Ø³ ${student.class} - ${student.teacher}
                    `;
                    absentList.appendChild(div);
                });
            });
        }

        function copyAbsentList() {
            if (allAbsentList.length === 0) {
                showError('Ù„ÛŒØ³Øª ØºØ§ÛŒØ¨â€ŒÙ‡Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª');
                return;
            }
            
            const now = new Date();
            const persianDate = now.toLocaleDateString('fa-IR');
            const persianDay = getPersianDayName(now);
            
            let copyText = `ØºØ§ÛŒØ¨Ø§ÛŒ Ø±ÙˆØ² ${persianDay}\n${persianDate}\nÙ…Ø¯Ø±Ø³Ù‡ Ø´Ù‡ÛŒØ¯ Ù†ÛŒØ§Ø³Ø±ÛŒ Û±\n\n`;
            
            const groupedByDate = {};
            allAbsentList.forEach(student => {
                const key = `${student.day} - ${student.date}`;
                if (!groupedByDate[key]) {
                    groupedByDate[key] = [];
                }
                groupedByDate[key].push(student);
            });
            
            Object.keys(groupedByDate).forEach(dateKey => {
                copyText += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;
                copyText += `ğŸ“… ${dateKey}\n`;
                copyText += `â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n`;
                
                groupedByDate[dateKey].forEach((student, index) => {
                    copyText += `${index + 1}. ${student.name} ${student.family}\n`;
                    copyText += `   Ù¾Ø§ÛŒÙ‡ ${student.grade} - Ú©Ù„Ø§Ø³ ${student.class} - ${student.teacher}\n\n`;
                });
            });
            
            copyText += `\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`;
            copyText += `Ø¬Ù…Ø¹ Ú©Ù„ ØºØ§ÛŒØ¨ÛŒÙ†: ${allAbsentList.length} Ù†ÙØ±`;
            
            navigator.clipboard.writeText(copyText).then(() => {
                showCopyNotification();
            }).catch(err => {
                const textArea = document.createElement('textarea');
                textArea.value = copyText;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showCopyNotification();
                } catch (err) {
                    showError('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù†');
                }
                document.body.removeChild(textArea);
            });
        }

        function showCopyNotification() {
            const notification = document.getElementById('copyNotification');
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }

        function resetForm() {
            document.getElementById('grade').value = '';
            document.getElementById('class').value = '';
            document.getElementById('class').disabled = true;
            document.getElementById('studentsList').style.display = 'none';
            document.getElementById('buttonGroup').style.display = 'none';
            document.getElementById('managerView').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            currentStudents = [];
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>